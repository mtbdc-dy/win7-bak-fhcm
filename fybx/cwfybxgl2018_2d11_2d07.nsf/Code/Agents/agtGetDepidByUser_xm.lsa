<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_9_0.dtd'>
<agent name='agtGetDepidByUser_xm' alias='根据报销人获取报销人所在部门' xmlns='http://www.lotus.com/dxl'
 version='9.0' replicaid='4825833E00419143' hide='v3' publicaccess='false'
 designerversion='8.5.3' restrictions='unrestricted'>
<noteinfo noteid='185e' unid='48258072000E0C3F4825808A0041DB62' sequence='23'>
<created><datetime>20161215T195920,02+08</datetime></created>
<modified><datetime>20181107T195906,89+08</datetime></modified>
<revised><datetime>20181024T092021,27+08</datetime></revised>
<lastaccessed><datetime>20181107T195906,89+08</datetime></lastaccessed>
<addedtofile><datetime>20181107T195906,89+08</datetime></addedtofile></noteinfo>
<updatedby><name>CN=oanewadmin/O=ppm</name><name>CN=oav5server1/O=ppm</name><name
>CN=oanewadmin/O=ppm</name><name>CN=oav5server1/O=ppm</name><name>CN=oanewadmin/O=ppm</name></updatedby>
<wassignedby><name>CN=oanewadmin/O=ppm</name></wassignedby>
<designchange><datetime>20181024T092127,51+08</datetime></designchange>
<trigger type='actionsmenu'/>
<documentset type='runonce'/><code event='options'><lotusscript>%REM
	Agent agtGetDepidByUser_xm
	Created 2016-12-8 by oanewadmin/ppm
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "Commonlib"

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	On Error GoTo errorhandle
	Dim session As New NotesSession
	Dim dbCur As NotesDatabase
	Dim note As NotesDocument
	Dim strBx As String
	

	Set dbCur = session.Currentdatabase
	Set note = session.Documentcontext
	
	strBx = getRefValue(note.Query_String_Decoded(0),"user=")
	MsgBox strBx
	Dim nmBx As New NotesName(strBx)
	
	
	Dim dbIndi As NotesDatabase
	Dim vwUser As NotesView
	Dim docUser As NotesDocument
	
	Set dbIndi = session.Getdatabase(dbCur.Server, "indishare/indinames.nsf")
	Set vwUser = dbIndi.Getview("vwRegUserByFullName")
	Set docUser = vwUser.Getdocumentbykey(nmBx.Canonical)
	Dim jsonarry As New Converjsonobject
	If Not docUser Is Nothing Then	
		Call jsonarry.Additem("dep", docUser.DepFullname(0))
		Call jsonarry.Additem("depid", docUser.DepartmentCode(0))
	Else
		Call jsonarry.Additem("dep", "")
		Call jsonarry.Additem("depid", "")
	End If
	Print |Content-Type:text/plain;Charset=GB2312|
	Print jsonarry.Tojson()
	Exit Sub
errorhandle:
	showError "Initialize"
End Sub</lotusscript></code>
<rundata processeddocs='0' exitcode='0'>
<agentmodified><datetime>20170227T094811,60+08</datetime></agentmodified></rundata>
<item name='$POID'><datetime>20181024T092021,27+08</datetime></item></agent>

