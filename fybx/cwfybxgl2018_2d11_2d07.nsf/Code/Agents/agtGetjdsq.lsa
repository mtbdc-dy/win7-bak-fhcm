<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_9_0.dtd'>
<agent name='agtGetjdsq' alias='获取关联接待申请' xmlns='http://www.lotus.com/dxl'
 version='9.0' replicaid='4825833E00419143' hide='v3' runaswebuser='true'
 publicaccess='false' designerversion='8.5.3' restrictions='unrestricted'>
<noteinfo noteid='1762' unid='482581B6000911FF482581A90038D26B' sequence='118'>
<created><datetime>20170928T182038,83+08</datetime></created>
<modified><datetime>20181107T195902,68+08</datetime></modified>
<revised><datetime>20181024T091953,71+08</datetime></revised>
<lastaccessed><datetime>20181107T195902,68+08</datetime></lastaccessed>
<addedtofile><datetime>20181107T195902,68+08</datetime></addedtofile></noteinfo>
<updatedby><name>CN=oanewadmin/O=ppm</name></updatedby>
<wassignedby><name>CN=oanewadmin/O=ppm</name></wassignedby>
<designchange><datetime>20181024T092059,96+08</datetime></designchange>
<trigger type='actionsmenu'/>
<documentset type='runonce'/><code event='options'><lotusscript>%REM
	Agent agtGetjdsq
	Created 2016-12-6 by oanewadmin/ppm
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "CommonLib"

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	On Error GoTo errorhandle
	Dim session As New NotesSession
	Dim dbCur As NotesDatabase
	Dim note As NotesDocument
	Dim nmCur As New NotesName(session.Effectiveusername)
	Set dbCur = session.Currentdatabase
	Set note = session.Documentcontext
	
	Dim strJdPath As String
	Dim dbJd As NotesDatabase
	Dim vwJd As NotesView
	Dim docJd As NotesDocument
	
	Dim jsonobj As New Converjsonobject
	Dim jsonarry As New Converjsonarray
	
	strJdPath= StrRight(dbCur.Filepath,"/")
	strJdPath= StrLeft(strJdPath,"/")
	strJdPath ="ppm/"+strJdPath+"/jdgl_gf.nsf"
	Set dbJd = session.Getdatabase(dbCur.Server, strJdPath)
	
	If dbJd.Isopen Then
		
		Set vwJd = dbJd.Getview("vwDocForBx_xm")
		Set docJd = vwJd.Getfirstdocument()
		While Not docJd Is Nothing
			Dim namestr As String
			namestr = Replace(nmCur.Canonical,"CN=","")
			namestr = Replace(namestr,"/O=ppm","")
			
			If docJd.fldNiGaoRen(0) = namestr Then
				'MSGBOX"======="+docJd.fldSFGL(0)
				If docJd.fldSFGL(0) ="0" Then
					
					Dim jsonarryobj As New Converjsonobject
					Call jsonarryobj.Additem("subject", docJd.fldSubject(0))
					Call jsonarryobj.Additem("unid", docJd.Universalid)
					Call jsonarry.Additem(jsonarryobj)
				End if
			End If
			Set docJd = vwJd.Getnextdocument(docJd)
		Wend
		
	End If
	Call jsonobj.Additem("items", jsonarry)
	Print |Content-Type:text/plain;Charset=GB2312|
	Print jsonobj.Tojson()
	Exit Sub
errorhandle:
	showError "Initialize"
End Sub</lotusscript></code>
<rundata processeddocs='0' exitcode='0' agentdata='C8FE310F297412314825833200152A87'>
<agentmodified><datetime>20181025T014913,49+08</datetime></agentmodified>
<agentrun><datetime>20181026T115346,10+08</datetime></agentrun>
<runlog>Started running agent 'agtGetjdsq|获取关联接待申请' on 2018-10-26 11:53:46
Ran LotusScript code
Done running agent 'agtGetjdsq|获取关联接待申请' on 2018-10-26 11:53:46
</runlog></rundata>
<item name='$POID'><datetime>20181024T091953,71+08</datetime></item></agent>

