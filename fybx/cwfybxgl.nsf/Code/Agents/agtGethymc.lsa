<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_9_0.dtd'>
<agent name='agtGethymc' alias='根据费用类型获取会议名称' xmlns='http://www.lotus.com/dxl'
 version='9.0' replicaid='4825807E001E75D5' hide='v3' publicaccess='false'
 designerversion='8.5.3' restrictions='unrestricted'>
<noteinfo noteid='12cea' unid='48258072000E0C3F48258078004D2730' sequence='25'>
<created><datetime>20161127T220243,04+08</datetime></created>
<modified><datetime>20181025T014920,67+08</datetime></modified>
<revised><datetime>20181024T092019,87+08</datetime></revised>
<lastaccessed><datetime>20181025T014920,66+08</datetime></lastaccessed>
<addedtofile><datetime>20171012T102128,03+08</datetime></addedtofile></noteinfo>
<updatedby><name>CN=oanewadmin/O=ppm</name><name>CN=oav5server1/O=ppm</name><name
>CN=oanewadmin/O=ppm</name><name>CN=oav5server1/O=ppm</name><name>CN=oanewadmin/O=ppm</name></updatedby>
<wassignedby><name>CN=oanewadmin/O=ppm</name></wassignedby>
<designchange><datetime>20181024T092126,12+08</datetime></designchange>
<trigger type='actionsmenu'/>
<documentset type='runonce'/><code event='options'><lotusscript>%REM
	Agent agtgetdepid
	Created 2016-11-2 by admin/ppm
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "commonlib"


</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	On Error GoTo errorhandle
	Dim session As New NotesSession
	Dim db As NotesDatabase
	Dim view As NotesView
	Dim doc As NotesDocument
	Dim note As NotesDocument
	Dim doccoll As NotesDocumentCollection
	Dim strappPath As String 
	Dim strsqr As String
	Set doc=session.Documentcontext
	
	Dim fylx As String 
	fylx=Getrefvalue(doc.Query_string_Decoded(0),"fylx=")
	strsqr=Getrefvalue(doc.Query_string_Decoded(0),"sqr=")
	Dim notename As New NotesName(strsqr)
    Dim strsqrcn As String 
    strsqrcn=notename.Canonical
	strappPath=Getrefvalue(doc.Query_string_Decoded(0),"strappPath=")
	'获取会议申请库
	Set db=session.Getdatabase("",strappPath+"/cwhyfysqgl.nsf")
	Set view=db.Getview("vwDocPublishedByHyFylx")
	Set doccoll=view.Getalldocumentsbykey(fylx+"+"+strsqrcn)
	Set note=doccoll.Getfirstdocument()
	Dim jsonobj As New Converjsonobject
	Dim jsonarry As New Converjsonarray
	While Not note Is Nothing 
		Dim jsonarryobj As New Converjsonobject
		Call jsonarryobj.Additem("hymc", note.fldhymc_xm(0))
		Call jsonarry.Additem(jsonarryobj)
		Set note=doccoll.Getnextdocument(note)
	Wend
	Call jsonobj.Additem("items", jsonarry)
	Print |Content-Type:text/plain;Charset=GB2312|
	Print jsonobj.Tojson()
	Exit sub
errorhandle:
	showerror("agtgetdepid")
End Sub</lotusscript></code>
<rundata processeddocs='0' exitcode='0' agentdata='0D3E211F6ACE162D482583320011DE0B'>
<agentmodified><datetime>20181025T014920,67+08</datetime></agentmodified>
<agentrun><datetime>20181029T093635,80+08</datetime></agentrun>
<runlog>Started running agent 'agtGethymc|根据费用类型获取会议名称' on 2018-10-29 09:36:35
Ran LotusScript code
Done running agent 'agtGethymc|根据费用类型获取会议名称' on 2018-10-29 09:36:35
</runlog></rundata>
<item name='$POID'><datetime>20181024T092019,87+08</datetime></item></agent>

