<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_9_0.dtd'>
<agent name='(agtGetWorkSchedule_xm)' alias='(获取工作日天数)' xmlns='http://www.lotus.com/dxl'
 version='9.0' replicaid='4825807E001E75D5' hide='v3' runaswebuser='true'
 publicaccess='true' designerversion='8.5.3' comment='删除原有投票结果文档并重新生成投票结果文档'
 restrictions='fulladminunrestricted'>
<noteinfo noteid='13782' unid='2271657F0F7AE5A5482581BD0011D657' sequence='6'>
<created><datetime>20171018T111449,83+08</datetime></created>
<modified><datetime>20181025T014912,58+08</datetime></modified>
<revised><datetime>20181024T085504,70+08</datetime></revised>
<lastaccessed><datetime>20181025T014912,57+08</datetime></lastaccessed>
<addedtofile><datetime>20171019T010657,78+08</datetime></addedtofile></noteinfo>
<updatedby><name>CN=oanewadmin/O=ppm</name><name>CN=oav5server1/O=ppm</name><name
>CN=oanewadmin/O=ppm</name></updatedby>
<wassignedby><name>CN=oanewadmin/O=ppm</name></wassignedby>
<designchange><datetime>20181024T085611,56+08</datetime></designchange>
<trigger type='agentlist'/>
<documentset type='all'/><code event='options'><lotusscript>%REM
	判断开始日期和结束日期分别是工作日还是休息日
	Created 2016-11-19 by wx
	Description: Comments for Library
%END REM
Option Public
Use "commonLib"
Use "LibWorkSchedule_xm"

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	On Error GoTo errorhandle
	Dim session As New NotesSession
	Dim note As NotesDocument
	Dim db As NotesDatabase
	Dim vw As NotesView
	Dim dcs As NotesDocumentCollection
	Dim strQueryString As String
	Dim strSubjectUNID As String
	Dim strResult As String
	Set note = session.DocumentContext
	strQueryString = note.query_string_decoded(0)
	strksrq = getRefValue( strQueryString ,"strksrq=" )
	strjsrq = getRefValue( strQueryString ,"strjsrq=" )
	strtype = getRefValue( strQueryString ,"strtype=" )
	struser = getRefValue( strQueryString ,"struser=" )+"/ppm"
	Dim strname As String
	strname = ""
	strname  =Stringifyvariant(struser)
	'计算工作日
	Dim daynum As Variant
	fnInitSchedule_xm(strname)
	daynum=fnGetSchedule_xm(strksrq,strjsrq)
	Dim result As Integer
	result = 0
	ForAll v In daynum  
		If(CStr(v) = "workday")Then
			result = result +1
		End If
	End ForAll	

	Print "Content-type: text/xml;Charset=utf-8"
	Print "&lt;?xml version='1.0' encoding='utf-8'?&gt;"
	Print |&lt;STAT&gt;|+ CStr(result) +|&lt;/STAT&gt;|
	Exit Sub
errorhandle:
	showerror "Initialize"
End Sub</lotusscript></code>
<rundata processeddocs='0' exitcode='0' agentdata='47DA5B3025266A1E48258163000E1DC9'>
<agentmodified><datetime>20170804T152002,58+08</datetime></agentmodified>
<agentrun><datetime>20171009T135509,30+08</datetime></agentrun>
<runlog>Started running agent 'agtGetWorkSchedule_xm|获取工作日天数' on 2017-10-09 13:55:09
Running on all documents in database: 46 total
Found 46 document(s) that match search criteria
Ran LotusScript code
Done running agent 'agtGetWorkSchedule_xm|获取工作日天数' on 2017-10-09 13:55:09
</runlog></rundata>
<item name='$POID'><datetime>20181024T085504,70+08</datetime></item></agent>

