<?xml version='1.0' encoding='utf-8'?>
<!DOCTYPE agent SYSTEM 'xmlschemas/domino_9_0.dtd'>
<agent name='agtZhuiJiaReaders_xm' xmlns='http://www.lotus.com/dxl' version='9.0'
 replicaid='4825807E001E75D5' hide='v3' publicaccess='false' designerversion='8.5.3'
 runonbehalfof='CN=oanewadmin/O=ppm' restrictions='fulladminunrestricted'>
<noteinfo noteid='e9b6' unid='42AD227FFDD0B76648258176001D65E3' sequence='15'>
<created><datetime>20170808T132106,27+08</datetime></created>
<modified><datetime>20181025T014921,47+08</datetime></modified>
<revised><datetime>20181024T092025,97+08</datetime></revised>
<lastaccessed><datetime>20181025T014921,46+08</datetime></lastaccessed>
<addedtofile><datetime>20170809T010432,95+08</datetime></addedtofile></noteinfo>
<updatedby><name>CN=oanewadmin/O=ppm</name></updatedby>
<wassignedby><name>CN=oanewadmin/O=ppm</name></wassignedby>
<designchange><datetime>20181024T092132,19+08</datetime></designchange>
<trigger type='actionsmenu'/>
<documentset type='runonce'/><code event='options'><lotusscript>%REM
	Agent agtFlagSubmitedHyys_xm
	Created 2016-12-25 by oanewadmin/ppm
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "Commonlib"

</lotusscript></code><code event='initialize'><lotusscript>Sub Initialize
	On Error GoTo errorhandle
	Dim session As New NotesSession
	Dim dbCur As NotesDatabase
	Dim agent As NotesAgent
	Dim note As NotesDocument
	Dim strdata As String
	Dim jkvresult As Variant
	Dim jsonReader As New Jsonreader
	Dim jsonobj As New Converjsonobject
	Dim i As Integer
	Dim strjkunid As String
	Dim strhkpzunid As string
	Dim appPath As String
	Dim dbjk As NotesDatabase
	Dim dbyf As notesDatabase
	Dim jkdoc As NotesDocument
	Dim reitem As NotesItem
	Dim hkreitem As NotesItem
	Dim hkdoc As notesDocument
	
	Set dbCur = session.Currentdatabase
	Set agent = session.Currentagent
	
	Set note = dbCur.Getdocumentbyid(agent.Parameterdocid)
	If Not note Is Nothing Then
		'MsgBox "2222"
		appPath=StrLeftBack(note.dbPath(0),"/")
		Set dbjk=session.Getdatabase("", appPath+"/yfkgl.nsf")
		
		strdata=note.Getfirstitem("hfldData_jkxz").Text
		strdata=Replace(strdata,Chr(10),"")
		strdata = Replace(strdata,Chr(13),"")
		If strdata &lt;&gt; "" Then 
			Set jsonobj=jsonReader.Parse(strdata)
			jkvresult=jsonobj.Items
			If jkvresult("items").count&lt;&gt;0 Then
				For i=0 To jkvresult("items").count-1
					strjkunid = jkvresult("items").items(i).items("jkunid")
					strhkpzunid = jkvresult("items").items(i).items("hkpzunid")
					'MsgBox "strjkunid=" + CStr(strjkunid)
					
					Set hkdoc = dbjk.Getdocumentbyunid(strhkpzunid)
					If Not hkdoc Is Nothing Then
						'MsgBox "3333888"
						Set hkreitem = hkdoc.Getfirstitem("DocumentAuthors")
						ForAll a In  note.DocumentAuthors
							'MsgBox "aa=" + CStr(a)
							Call hkreitem.Appendtotextlist(a)
						End ForAll
						Call hkdoc.Save(True,False)
						If hkdoc.Hasitem("strPath") Then
							Set dbyf=session.Getdatabase("",hkdoc.strPath(0))
							Set jkdoc = dbyf.Getdocumentbyunid(strjkunid)
							If Not jkdoc Is Nothing Then
								'MsgBox "333377777"
								Set reitem = jkdoc.Getfirstitem("ORIDOCUMENTREADERS")
								ForAll a In  note.DocumentAuthors
									'MsgBox "yyyy=" + CStr(a)
									Call reitem.Appendtotextlist(a)
								End ForAll
								Call jkdoc.Save(True,False)
							End If
						Else
							Set jkdoc = dbjk.Getdocumentbyunid(strjkunid)
							If Not jkdoc Is Nothing Then
								'MsgBox "3333"
								Set reitem = jkdoc.Getfirstitem("ORIDOCUMENTREADERS")
								ForAll a In  note.DocumentAuthors
									'MsgBox "a=" + CStr(a)
									Call reitem.Appendtotextlist(a)
								End ForAll
								Call jkdoc.Save(True,False)
							End If
						End If
					End If
				Next
			End If
		End If
		
	End If
	If Not note Is Nothing Then
		'MsgBox "2222"
		appPath=StrLeftBack(note.dbPath(0),"/")
		Set dbjk=session.Getdatabase("", appPath+"/cwjiekgl.nsf")
		
		strdata=note.Getfirstitem("hfldData_jkxz").Text
		strdata=Replace(strdata,Chr(10),"")
		strdata = Replace(strdata,Chr(13),"")
		If strdata &lt;&gt; "" Then 
			Set jsonobj=jsonReader.Parse(strdata)
			jkvresult=jsonobj.Items
			If jkvresult("items").count&lt;&gt;0 Then
				For i=0 To jkvresult("items").count-1
					strjkunid = jkvresult("items").items(i).items("jkunid")
					strhkpzunid = jkvresult("items").items(i).items("hkpzunid")
					'MsgBox "strjkunid=" + CStr(strjkunid)
					
					Set hkdoc = dbjk.Getdocumentbyunid(strhkpzunid)
					If Not hkdoc Is Nothing Then
						'MsgBox "3333888"
						Set hkreitem = hkdoc.Getfirstitem("DocumentAuthors")
						ForAll a In  note.DocumentAuthors
							'MsgBox "aa=" + CStr(a)
							Call hkreitem.Appendtotextlist(a)
						End ForAll
						Call hkdoc.Save(True,False)
						If hkdoc.Hasitem("strPath") Then
							Set dbyf=session.Getdatabase("",hkdoc.strPath(0))
							Set jkdoc = dbyf.Getdocumentbyunid(strjkunid)
							If Not jkdoc Is Nothing Then
								'MsgBox "333377777"
								Set reitem = jkdoc.Getfirstitem("ORIDOCUMENTREADERS")
								ForAll a In  note.DocumentAuthors
									'MsgBox "yyyy=" + CStr(a)
									Call reitem.Appendtotextlist(a)
								End ForAll
								Call jkdoc.Save(True,False)
							End If
						Else
							Set jkdoc = dbjk.Getdocumentbyunid(strjkunid)
							If Not jkdoc Is Nothing Then
								'MsgBox "3333"
								Set reitem = jkdoc.Getfirstitem("ORIDOCUMENTREADERS")
								ForAll a In  note.DocumentAuthors
									'MsgBox "a=" + CStr(a)
									Call reitem.Appendtotextlist(a)
								End ForAll
								Call jkdoc.Save(True,False)
							End If
						End If
					End If
				Next
			End If
		End If
		
	End If
	Exit Sub
errorhandle:
	'showError "Initialize"
	MsgBox "agtZhuiJiaReaders_xm has error: " + CStr(Error()) + " at line: " + CStr(Erl())
End Sub</lotusscript></code>
<rundata processeddocs='0' exitcode='0' agentdata='150C4817229E21EA48258332002FFBE6'>
<agentmodified><datetime>20181025T014921,47+08</datetime></agentmodified>
<agentrun><datetime>20181108T175530,73+08</datetime></agentrun>
<runlog>Started running agent 'agtZhuiJiaReaders_xm' on 2018-11-08 17:55:30
Ran LotusScript code
Done running agent 'agtZhuiJiaReaders_xm' on 2018-11-08 17:55:30
</runlog></rundata>
<item name='$POID'><datetime>20181024T092025,97+08</datetime></item></agent>

